nuget:
  account_feed: true
  
init:
  - git config --global core.autocrlf true
  
install:
 - cmd: nuget sources add -Name api.nuget.org -Source https://api.nuget.org/v3/index.json

configuration: Release

before_build:
 - ps: "&{$Branch='dev';iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/aspnet/Home/dev/dnvminstall.ps1'))}"
 - ps: dnvm install 1.0.0-rc1-final
 - ps: dnvm use 1.0.0-rc1-final
 - ps: npm cache clean
 - ps: dnu restore

build_script:
 - ps: cd AngularMiddleware
 - ps: (Get-Content "project.json") -replace '"1\.0\.0-\*"', ('"1.0.' + $env:APPVEYOR_BUILD_NUMBER + '"') | Set-Content "project.json"
 - ps: dnu pack --configuration $env:CONFIGURATION --out dist

artifacts:
 - path: dist\*.nupkg

deploy:
- provider: GitHub
  artifact: /.*\.nupkg/
  draft: false
  prerelease: false
  on:
    branch: master
    appveyor_repo_tag: true
